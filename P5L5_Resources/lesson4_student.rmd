Lesson 4
========================================================

library(ggplot2)

# setwd("/Users/sarauenoyama/AnacondaProjects/Udacity_DAND/P5L5_Resources")
setwd("/Users/sarauenoyama/Desktop/U")

pf <- read.delim('pseudo_facebook.tsv')

***

### Scatterplots and Perceived Audience Size
Notes:
readings
 - Moira's Investigation from Lesson 3
   https://classroom.udacity.com/courses/ud651/lessons/755618712/concepts/8140986010923
   
 - Bernstein, M. S., Bakshy, E., Burke, M., & Karrer, B. (2013). Quantifying the invisible audience in social networks. In Proceedings of the SIGCHI Conference on Human Factors in Computing Systems (CHI 2013), pp. 21-30.
   http://hci.stanford.edu/publications/2013/invisibleaudience/invisibleaudience.pdf
   
***

### Scatterplots
Notes:
You can also read in the data using the following code:

# read.delim('pseudo_facebook.tsv')

The equivalent ggplot syntax for the scatterplot:

# ggplot(aes(x = age, y = friend_count), data = pf) +
# geom_point()

There isn't a user interface (UI) feature on Facebook's website that causes people to pick the particular age of 69 or the older ages. In general, it is a good idea to think about what caused certain oddities or values in data sets. This can help explain dirty data.

```{r Scatterplots}

```

***

#### What are some things that you notice right away?
Response:

***

### ggplot Syntax
Notes:
readings
 - ggplot2 geoms
   https://ggplot2.tidyverse.o
   
 - ggplot2 tutorial by Ramon Saccilotto
   http://bbs.ceb-institute.org/wp-content/uploads/2011/09/handout_ggplot2.pdf
   
```{r ggplot Syntax}

```

***

### Overplotting
Notes:

```{r Overplotting}

```

#### What do you notice in the plot?
Response:

***

### Coord_trans()
Notes:
Look up the documentation for coord_trans() by running this line of code ?coord_trans or visit http://docs.ggplot2.org/current/coord_trans.html.

```{r Coord_trans()}

```

#### Look up the documentation for coord_trans() and add a layer to the plot that transforms friend_count using the square root function. Create your plot!

```{r}

```

#### What do you notice?

***

### Alpha and Jitter
Notes:

```{r Alpha and Jitter}

```

***

### Overplotting and Domain Knowledge
Notes:
readings
 - Bernstein, M. S., Bakshy, E., Burke, M., & Karrer, B. (2013). Quantifying the invisible audience in social networks. In Proceedings of the SIGCHI Conference on Human Factors in Computing Systems (CHI 2013), pp. 21-30.
   http://hci.stanford.edu/publications/2013/invisibleaudience/invisibleaudience.pdf
   
***

### Conditional Means
Notes:
Important Notice! Please note that in newer versions of dplyr (0.3.x+), the syntax %.% has been deprecated and replaced with %>%.

Another warning: Version 0.4.0 of dplyr has a bug when using the median function on the summarize layer, depending on the nature of the data being summarized. You may need to cast the data as a numeric (float) type when using it on your local machine, e.g. median(as.numeric(var)).

Learn more about the dplyr package. 
https://blog.rstudio.com/2014/01/17/introducing-dplyr/

Introduction to dplyr (knitted html file)
http://rstudio-pubs-static.s3.amazonaws.com/11068_8bc42d6df61341b2bed45e9a9a3bf9f4.html

The following tutorials are presented by Hadley Wickham at useR 2014.

 - Introduction of dplyr
   https://www.r-bloggers.com/hadley-wickham-presents-dplyr-at-user-2014/
 - dplyr Tutorial Part 1
   https://www.r-bloggers.com/hadley-wickhams-dplyr-tutorial-at-user-2014-part-1/
 - dplyr Tutorial Part 2
   https://www.r-bloggers.com/hadley-wickhams-dplyr-tutorial-at-user-2014-part-2/

There are other ways to work with data and create new data frames without using the dplyr package. Learn about the R functions lapply, tapply, and split in a blog post.
https://rollingyours.wordpress.com/2014/10/20/the-lapply-command-101/

For more on geom_line(), you can check the documentation here.
https://ggplot2.tidyverse.org/reference/geom_path.html


```{r Conditional Means}

```

Create your plot!

```{r Conditional Means Plot}

```

***

### Overlaying Summaries with Raw Data
Notes:
Note: ggplot 2.0.0 changes the syntax for parameter arguments to functions when using stat = 'summary'. To denote parameters that are being set on the function specified by fun.y, use the fun.args argument, e.g.:

# ggplot( ... ) +
# geom_line(stat = 'summary', fun.y = quantile,
            fun.args = list(probs = .9), ... )
To zoom in, the code should use thecoord_cartesian(xlim = c(13, 90)) layer rather than xlim(13, 90) layer.

Look up documentation for coord_cartesian() and quantile() if you're unfamiliar with them.

Try an example and practice problem for calculating quantiles (percentiles).
http://www.r-tutor.com/elementary-statistics/numerical-measures/percentile

```{r Overlaying Summaries with Raw Data}

```

#### What are some of your observations of the plot?
Response:

***

### Moira: Histogram Summary and Scatterplot
See the Instructor Notes of this video to download Moira's paper on perceived audience size and to see the final plot.

Notes:
readings
 - Bernstein, M. S., Bakshy, E., Burke, M., & Karrer, B. (2013). Quantifying the invisible audience in social networks. In Proceedings of the SIGCHI Conference on Human Factors in Computing Systems (CHI 2013), pp. 21-30.
   http://hci.stanford.edu/publications/2013/invisibleaudience/invisibleaudience.pdf
   

***

### Correlation
Notes:
readings
 - A Visual Guide to Correlation
   https://s3.amazonaws.com/udacity-hosted-downloads/ud651/correlation_images.jpeg
 - Correlation Coefficient
   http://www.r-tutor.com/elementary-statistics/numerical-measures/correlation-coefficient
 - Intro to Inferential Statistics- Correlation
   https://classroom.udacity.com/courses/ud201/lessons/1345848540/concepts/1715827370923
   
Correlation coefficients are often denoted with the greek letter \rho?? (rho), in addition to the letter r.

The default method for computing the correlation coefficient is Pearson, and this is true for most statistical software. You do not need to pass the method parameter when calculating the Pearson Product Moment Correlation.

```{r Correlation}
age = pf$age
friend = pf$friend_count

cor.test(age, friend, method = 'pearson')
# another way is
# with(pf, cor.test(age, friend, method = 'pearson'))
```

Look up the documentation for the cor.test function.

What's the correlation between age and friend count? Round to three decimal places.
Response:

***

### Correlation on Subsets
Notes:
What are monotonic functions?
https://en.wikipedia.org/wiki/Monotonic_function

Definition: 
ostensibly - apparently or purportedly, but perhaps not actually

Use the subset command or bracket notation for this exercise. The grader will not accept other techniques.

```{r Correlation on Subsets}
with(subset(pf, age <= 70), cor.test(age, friend_count))
```

***

### Correlation Methods
Notes: 
Correlation Methods: Pearson's r, Spearman's rho, and Kendall's tau
http://www.statisticssolutions.com/correlation-pearson-kendall-spearman/

***

## Create Scatterplots
# Notes:
# Create a scatterplot of likes_received (y)
# vs. www_likes_received (x). Use any of the
# techniques that you've learned so far to
# modify the plot.

# ENTER ALL OF YOUR CODE TO CREATE THE PLOT BELOW THIS LINE.
# ===========================================================

```{r}
ggplot(aes(x = www_likes_received, y = likes_received), data = pf) + geom_point()

```

***

### Strong Correlations
Notes:
The correlation coefficient is invariant under a linear transformation of either X or Y, and the slope of the regression line when both X and Y have been transformed to z-scores is the correlation coefficient.

It's important to note that we may not always be interested in the bulk of the data. Sometimes, the outliers ARE of interest, and it's important that we understand their values and why they appear in the data set.

```{r Strong Correlations}
ggplot(aes(x = www_likes_received, y = likes_received), data = pf) + 
  geom_point() + 
  xlim(0, quantile(pf$www_likes_received, 0.95)) +
  ylim(0, quantile(pf$likes_received, 0.95)) + 
  geom_smooth(method = 'lm', color = 'red')
```

What's the correlation between the two variables? Include the top 5% of values for the variable in the calculation and round to 3 decimal places.

```{r Correlation Calcuation}
cor.test(pf$www_likes_received, pf$likes_received, method = 'pearson')
```

Response:

***

### Moira on Correlation
Notes:
Assumptions of Linear Regression
https://en.wikipedia.org/wiki/Linear_regression#Assumptions

***

### More Caution with Correlation
# Create a scatterplot of temperature (Temp)
# vs. months (Month).

# ENTER ALL OF YOUR CODE TO CREATE THE PLOT BELOW THIS LINE.
# ===========================================================

Notes:
Argument matching (when not providing them by name) in R is a bit complex.

First, arguments (or parameters) can be matched by name. If a parameter matches exactly, it is "removed" from the argument list and the remaining unnamed arguments are matched in the order that they are listed in the function definition.

R does the following to match arguments... 

checks for exact match of named argument
checks for a partial match of the argument
checks for a positional match
If R does not find a match for a parameter, it typically throws an "unused" parameter error.

Type str(functionName) to find the order of the parameters and learn more about the parameters of an R function. 

The example covered in the next few videos comes from a practice problem in Weisberg, S. (2005). Applied Linear Regression, 3rd edition. New York: Wiley.
http://users.stat.umn.edu/~sandy/alr3ed/website/

```{r More Caution With Correlation}
install.packages('alr3')
library(alr3)
data(Mitchell)
?Mitchell
```

Create your plot!

```{r Temp vs Month}
ggplot(aes(x = Temp, y = Month), data = Mitchell) + geom_point()
```

***

### Noisy Scatterplots
Notes:
The package is 'alr3' and the data set is called 'Mitchell'. Run the following code to load the data.

# install.packages(alr3)
# library(alr3)

# data(Mitchell)


a. Take a guess for the correlation coefficient for the scatterplot.

b. What is the actual correlation of the two variables?
(Round to the thousandths place)

```{r Noisy Scatterplots}
cor.test(Mitchell$Temp, Mitchell$Month, method = 'pearson')
```

***

### Making Sense of Data
Notes:
There are many alternate solutions for showing the data. Please share any alternate answers and approaches in the discussions.

As of ggplot 2.0, you will need to use a scale_x_continuous() layer instead of scale_x_discrete(), since the Month is considered a numeric variable.


```{r Making Sense of Data}
ggplot(data = Mitchell, aes(x = Month, y = Temp)) +
  geom_point() + 
  scale_x_continuous(breaks=seq(0,203,12))
  
```

***

### A New Perspective

What do you notice?
Response:

Watch the solution video and check out the Instructor Notes!
Notes:
You could also get perspective on this data by overlaying each year's data on top of each other, giving a clear, generally sinusoidal graph. You can do this by using the R's modulus operator %% in your code. Try running the code below!
https://en.wikipedia.org/wiki/Modular_arithmetic

# ggplot(aes(x=(Month%%12),y=Temp), data=Mitchell)+
#  geom_point()

Data Visualization Pioneers

 - John Tukey
   https://en.wikipedia.org/wiki/John_Tukey

 - William Playfair
   https://en.wikipedia.org/wiki/William_Playfair
   
 - William Playfair and the Psychology of Graphs
   http://www.psych.utoronto.ca/users/spence/Spence%20(2006).pdf
   
There are other measures of associations that can detect this. The dcor.ttest() function in the energy package implements a non-parametric test of the independence of two variables. While the Mitchell soil dataset is too coarse to identify a significant dependency between "Month" and "Temp", we can see the difference between dcor.ttest and cor.test through other examples, like the following:

# x <- seq(0, 4*pi, pi/20)
# y <- cos(x)
# qplot(x = x, y = y)
# dcor.ttest(x, y)


***

### Understanding Noise: Age to Age Months
# Create a new variable, 'age_with_months', in the 'pf' data frame.
# Be sure to save the variable in the data frame rather than creating
# a separate, stand-alone variable. You will need to use the variables
# 'age' and 'dob_month' to create the variable 'age_with_months'.

# Assume the reference date for calculating age is December 31, 2013.

# This programming assignment WILL BE automatically graded. For
# this exercise, you need only create the 'age_with_months' variable;
# no further processing of the data frame is necessary.

# DO NOT DELETE THIS NEXT LINE OF CODE
# ========================================================================
pf <- read.delim('pseudo_facebook.tsv')


# ENTER YOUR CODE BELOW THIS LINE
# ========================================================================

```{r Understanding Noise: Age to Age Months}

pf$age_with_months <- pf$age + (12 - pf$dob_month)/12

pf$age_with_months <- pf$age + (1 - pf$dob_month / 12)
```

Notes:
Assume the reference date for calculating age is December 31, 2013 and that the age variable gives age in years at the end of 2013.

The variable age_with_months in the data frame pf should be a decimal value. For example, the value of age_with_months for a 33 year old person born in March would be 33.75 since there are nine months from March to the end of the year. Similarly, someone who was 6 years and 6 months old would have an age_with_months value of 6.5.

At 0:26-0:28 of the solution video, Chris misspeaks. He should say "So our numerator would be 9. 
Two alternate solutions: 
# pf$age_with_months <- pf$age + (1 - pf$dob_month / 12)
# pf$age_with_months <- with(pf, age + (1 - dob_month / 12))

***

### Age with Months Means
# Create a new data frame called
# pf.fc_by_age_months that contains
# the mean friend count, the median friend
# count, and the number of users in each
# group of age_with_months. The rows of the
# data framed should be arranged in increasing
# order by the age_with_months variable.

# For example, the first two rows of the resulting
# data frame would look something like...

# age_with_months  friend_count_mean	friend_count_median	n
#              13            275.0000                   275 2
#        13.25000            133.2000                   101 11


# See the Instructor Notes for two hints if you get stuck.
# This programming assignment will automatically be graded.

# DO NOT DELETE THESE NEXT THREE LINES OF CODE
# ========================================================================
pf <- read.delim('/datasets/ud651/pseudo_facebook.tsv')
pf$age_with_months <-pf$age + (1 - pf$dob_month / 12)
suppressMessages(library(dplyr))

# ENTER YOUR CODE BELOW THIS LINE
# ========================================================================



```{r Age with Months Means}
pf.fc_by_age_months <- pf %>%
group_by(age_with_months) %>%
summarise(friend_count_mean = mean(as.numeric(friend_count)), 
                       friend_count_median = median(as.numeric(friend_count)), 
                       n = n()) %>%
arrange(age_with_months)
  
```

Programming Assignment
```{r Programming Assignment}
pf$age_with_months <- pf$age + (1 - pf$dob_month / 12)
```

Notes:
Important Notice! Please note that in newer versions of dplyr (0.3.x+), the syntax %.% has been deprecated and replaced with %>%. Videos in the course use %.%, which will produce warning messages. If you answer using the chain operator, you should use %>% instead. Another warning: Version 0.4.0 of dplyr has a bug when using the median function on the summarize layer, depending on the nature of the data being summarized. You may need to cast the data as a numeric (float) type to get the expected results, e.g. median(as.numeric(var)).

A few additional hints follow below: 



Hint 1: Use the group_by(), summarise(), and arrange() functions in the dplyr package to split the data frame by age_with_month. Make sure you arrange by the correct variable (it's not age anymore). 



Hint 2: The code should look similar to the code when we split the data frame by age and found summaries:

# age_groups <- group_by(pf, age)
# pf.fc_by_age <- summarise(age_groups,
#                           friend_count_mean = 
# mean(friend_count),
#                           friend_count_median = 
# median(friend_count),
#                           n = n())
# pf.fc_by_age <- arrange(pf.fc_by_age, age)
# head(pf.fc_by_age)


***

### Noise in Conditional Means
# This programming assignment will not be graded, but when you submit your code,
# the assignment will be marked as correct. By submitting your code, we can add
# to the feedback messages and address common mistakes in the Instructor Notes.

# You can assess your work by watching the solution video.


# Create a new line plot showing friend_count_mean versus the new variable,
# age_with_months. Be sure to use the correct data frame (the one you created
# in the last exercise) AND subset the data to investigate users with ages less
# than 71.

# ENTER YOUR CODE BELOW THIS LINE.
# ===============================================================

```{r Noise in Conditional Means}
ggplot(aes(x = age_with_months, y = friend_count_mean), data = pf.fc_by_age_months) +
  geom_line()


ggplot(aes(x = age_with_months, y = friend_count_mean), 
       data = subset(pf.fc_by_age_months, age_with_months < 71)) +
  geom_line()
```

***

### Smoothing Conditional Means
Notes:

```{r Smoothing Conditional Means}

```

***

### Which Plot to Choose?
Notes:

***

### Analyzing Two Variables
Reflection:

***

Click **KnitHTML** to see all of your hard work and to have an html
page of this lesson, your answers, and your notes!

